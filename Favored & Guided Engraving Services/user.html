<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>My Account | Favored & Guided Engraving</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="css/base.css" />
</head>
<body>

<header class="navbar">
    <div class="nav-left" style="display: flex; align-items: center;">
        <img src="assets/logo.png" alt="Favored & Guided" class="logo" style="width: 45px; height: 45px; object-fit: contain; margin-right: 12px;" />
        <div style="display: flex; flex-direction: column; line-height: 1.2;">
            <span class="brand" style="font-size: 1.4rem; margin-left: 0;">Favored & Guided</span>
            <small style="font-size: 0.7rem; color: var(--taupe); letter-spacing: 1px;">FAITH-INSPIRED ENGRAVING</small>
        </div>
    </div>

    <nav class="nav-center">
        <a href="javascript:void(0)" onclick="showSection('hero')" class="active" id="nav-hero">Home</a>
        <a href="javascript:void(0)" onclick="showSection('products')" id="nav-products">Product</a>
        <a href="javascript:void(0)" onclick="showSection('about')" id="nav-about">About us</a>
    </nav>

    <div class="nav-right">
        <div class="user-menu-dropdown">
            <button class="btn-primary dropdown-toggle">
                <i class="fas fa-user-circle"></i> 
                <span id="userNameDisplay">Account</span> 
                <i class="fas fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <a href="javascript:void(0)" onclick="showSection('account')">
                    <i class="fas fa-user-edit"></i> Profile Settings
                </a>
                <a href="javascript:void(0)" onclick="showSection('order')">
                    <i class="fas fa-shopping-bag"></i> My Orders
                </a>
                <a href="javascript:void(0)" onclick="showSection('wishlist')" id='nav-wishlist'>
                    <i class="fas fa-heart"></i> Wishlist
                </a>
                <a href="javascript:void(0)" onclick="showSection('change-password')">
                    <i class="fas fa-key"></i> Change Password
                </a>
                <hr>
                <a href="javascript:void(0)" onclick="logoutUser()" class="logout-link">
                    <i class="fas fa-sign-out-alt"></i> Log Out
                </a>    
            </div>
        </div>
    </div>
</header>

<main>
    <section id="hero" class="hero" style="min-height: 60vh; display: flex; align-items: center; justify-content: center;">
        <div style="display: flex; align-items: center; justify-content: space-between; width: 100%; max-width: 1300px; margin: 0 auto; padding: 0 6%;">
            
            <!-- Left side - Welcome text (centered) -->
            <div class="hero-content" style="flex: 1; max-width: 600px; text-align: center; margin: 0 auto;">
                <span class="badge" style="margin-bottom: 15px; display: inline-block;">WELCOME BACK</span>
                <h1 style="font-size: clamp(2.5rem, 4vw, 3.5rem); line-height: 1.2; margin-bottom: 15px; color: var(--walnut);">
                    Peace be with you,<br><span id="welcomeName" style="color: var(--primary);"></span>
                </h1>
                <p style="font-size: 1.1rem; color: var(--text-muted); margin-bottom: 30px; max-width: 500px; margin-left: auto; margin-right: auto;">
                    Your spiritual journey continues. Explore our latest faith-inspired collections and handcrafted engravings.
                </p>
                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button class="btn-primary" onclick="showSection('products')" style="padding: 12px 28px;">
                        <i class="fas fa-search" style="margin-right: 8px;"></i> Browse Shop
                    </button>
                    <button class="btn-outline" onclick="showSection('order')" style="padding: 12px 28px; background: white;">
                        <i class="fas fa-shopping-bag" style="margin-right: 8px;"></i> My Orders
                    </button>
                </div>
            </div>
            
            <!-- Right side - Image card (smaller for logged in users) -->
            <div class="hero-image" style="flex: 0.8; max-width: 350px; margin-left: 40px;">
                <div style="background: white; padding: 15px; border-radius: 25px; box-shadow: var(--shadow-soft); border: 1px solid var(--sand);">
                    <img src="assets/hero-engraving.png" alt="Handcrafted Wood Engraving" style="width: 100%; border-radius: 15px; display: block;">
                    <div style="padding: 10px 0 0; text-align: center;">
                        <p style="font-weight: 600; color: var(--walnut); margin-bottom: 2px;">New Arrivals</p>
                        <p style="color: var(--primary); font-size: 0.85rem;">Faith Collection</p>
                    </div>
                </div>
            </div>
            
        </div>
    </section>

    <section id="products" class="section" style="display:none;">
        <div style="text-align: center; margin-bottom: 50px;">
            <h2 class="section-title">Shop Collection</h2>
        </div>
        <div class="products-grid" id="products-container"></div>
    </section>

    <section id="account" class="section" style="display:none;">
        <div class="profile-overview">
            <div class="profile-header">
                <div class="profile-avatar" id="profileAvatar">U</div>
                <div class="profile-title">
                    <h3>Profile Settings</h3>
                    <p>Manage your personal information</p>
                </div>
            </div>
            
            <div class="profile-details">
                <div class="profile-detail-item">
                    <div class="detail-icon">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="detail-content">
                        <div class="detail-label">Full Name</div>
                        <div class="detail-value" id="accountFullname">Loading...</div>
                    </div>
                </div>
                
                <div class="profile-detail-item">
                    <div class="detail-icon">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <div class="detail-content">
                        <div class="detail-label">Email Address</div>
                        <div class="detail-value" id="accountEmail">Loading...</div>
                    </div>
                </div>
                
                <div class="profile-detail-item">
                    <div class="detail-icon">
                        <i class="fas fa-phone-alt"></i>
                    </div>
                    <div class="detail-content">
                        <div class="detail-label">Phone Number</div>
                        <div class="detail-value" id="accountPhone">Not Set</div>
                    </div>
                </div>
            </div>
            
            <div class="profile-actions">
                <button class="btn-primary" onclick="showSection('edit-details')">
                    <i class="fas fa-edit"></i> Edit Profile
                </button>
                <button class="btn-outline" onclick="showSection('change-password')">
                    <i class="fas fa-key"></i> Change Password
                </button>
            </div>
        </div>
    </section>


    <section id="order" class="section" style="display:none;">
        <div class="section-header">
            <h2 class="section-title">My Orders</h2>
            <p class="section-sub">Track and manage your engraved items</p>
        </div>
        
        <!-- Order Stats Summary -->
        <div class="stats-grid" id="order-stats"></div>
        
        <!-- Order Filters -->
        <div class="filter-group" id="order-filters">
            <button class="filter-btn active" onclick="filterUserOrders('all')">All Orders</button>
            <button class="filter-btn" onclick="filterUserOrders('pending')">Pending</button>
            <button class="filter-btn" onclick="filterUserOrders('preparing')">Preparing</button>
            <button class="filter-btn" onclick="filterUserOrders('ready')">Ready for Pickup</button>
            <button class="filter-btn" onclick="filterUserOrders('completed')">Completed</button>
        </div>
        
        <!-- Orders Container -->
        <div class="order-grid" id="order-container"></div>
    </section>

    <section id="wishlist" class="section" style="display:none;">
        <!-- Enhanced Wishlist Header -->
        <div class="wishlist-header">
            <div class="wishlist-title-section">
                <h2>My Wishlist</h2>
                <p>Items you've hearted for later</p>
            </div>
            <div class="wishlist-stats">
                <div class="wishlist-stats-item">
                    <i class="fas fa-heart"></i>
                    <span id="wishlist-count">0</span> items
                </div>
                <div class="wishlist-stats-item">
                    <i class="fas fa-tag"></i>
                    <span id="wishlist-total">â‚±0</span>
                </div>
            </div>
        </div>

        <!-- Wishlist Actions Bar -->
        <div class="wishlist-actions">
            <div class="wishlist-filters">
                <button class="wishlist-filter-btn active" onclick="filterWishlist('all')">All Items</button>
                <button class="wishlist-filter-btn" onclick="filterWishlist('in-stock')">In Stock</button>
                <button class="wishlist-filter-btn" onclick="filterWishlist('low-stock')">Low Stock</button>
            </div>
            <div class="wishlist-sort">
                <label for="wishlist-sort">Sort by:</label>
                <select id="wishlist-sort" onchange="sortWishlist(this.value)">
                    <option value="date-desc">Recently Added</option>
                    <option value="price-asc">Price: Low to High</option>
                    <option value="price-desc">Price: High to Low</option>
                    <option value="name-asc">Name: A to Z</option>
                </select>
            </div>
        </div>

        <!-- Wishlist Items Grid -->
        <div class="products-grid" id="wishlist-container"></div>
    </section>

    <!-- Edit Details Section - Redesigned -->
    <section id="edit-details" class="section" style="display:none;">
        <div class="edit-profile-card">
            <div class="edit-profile-header">
                <h3>Edit Profile</h3>
                <p>Update your personal information</p>
            </div>
            
            <form id="editDetailsForm">
                <div class="edit-form-group">
                    <label for="editFullname">Full Name</label>
                    <input type="text" id="editFullname" placeholder="Enter your full name" required>
                </div>
                
                <div class="edit-form-group">
                    <label for="editPhone">Phone Number</label>
                    <input type="tel" id="editPhone" placeholder="Enter your phone number" required>
                </div>
                
                <button type="submit" class="btn-primary" style="width: 100%; padding: 16px; margin-top: 10px;">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </form>
        </div>
    </section>

    <!-- Change Password Section - Redesigned -->
    <section id="change-password" class="section" style="display:none;">
        <div class="change-password-card">
            <div class="password-header">
                <h3>Change Password</h3>
                <p>Choose a strong password to keep your account secure</p>
            </div>
            
            <form id="changePasswordForm">
                <div class="password-form-group">
                    <label for="newPassword">New Password</label>
                    <div class="password-wrapper-modern">
                        <input type="password" id="newPassword" placeholder="Enter new password" required minlength="8">
                        <i class="far fa-eye toggle-password-modern" onclick="togglePasswordModern('newPassword', this)"></i>
                    </div>
                    <div class="password-hint" id="newPasswordHint">
                        <i class="fas fa-info-circle"></i>
                        Minimum 8 characters
                    </div>
                </div>
                
                <div class="password-form-group">
                    <label for="confirmNewPassword">Confirm Password</label>
                    <div class="password-wrapper-modern">
                        <input type="password" id="confirmNewPassword" placeholder="Confirm new password" required minlength="8">
                        <i class="far fa-eye toggle-password-modern" onclick="togglePasswordModern('confirmNewPassword', this)"></i>
                    </div>
                    <div class="password-hint" id="confirmPasswordHint">
                        <i class="fas fa-info-circle"></i>
                        Passwords must match
                    </div>
                </div>
                
                <button type="submit" class="btn-primary" style="width: 100%; padding: 16px; margin-top: 10px;">
                    <i class="fas fa-lock"></i> Update Password
                </button>
            </form>
        </div>
    </section>
</main>

<footer class="footer">
    <div class="footer-container">
        <div class="footer-col">
            <h3>Favored & Guided</h3>
            <p>Crafting faith-inspired wooden engravings that speak to your soul. Each piece is lovingly handcrafted with attention to detail and spiritual meaning.</p>
            <div class="social-links">
                <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                <a href="#" aria-label="Pinterest"><i class="fab fa-pinterest"></i></a>
            </div>
        </div>
        
        <div class="footer-col">
            <h4>Explore</h4>
            <ul>
                <li><a href="javascript:void(0)" onclick="showSection('hero')">Home</a></li>
                <li><a href="javascript:void(0)" onclick="showSection('products')">Our Collection</a></li>
                <li><a href="javascript:void(0)" onclick="showSection('about')">Our Story</a></li>
            </ul>
        </div>
        
        <div class="footer-col">
            <h4>Connect With Us</h4>
            <p><i class="fas fa-phone-alt"></i> (555) 123-4567</p>
            <p><i class="fas fa-envelope"></i> info@favoredguide.com</p>
            <p><i class="fas fa-map-marker-alt"></i> 123 Faith Avenue, Craft City</p>
            <p><i class="fas fa-clock"></i> Mon-Fri: 9am - 6pm</p>
        </div>
    </div>
    
    <div class="footer-bottom">
        <p>&copy; 2026 Favored & Guided Engraving. All rights reserved. | Crafted with faith and love</p>
    </div>
</footer>

<div id="chat-container" class="chat-container">
    <div class="chat-header" onclick="toggleChat()">
        <span><i class="fas fa-comment-dots"></i> Support</span>
        <i class="fas fa-chevron-up" id="chat-icon"></i>
    </div>
    <div id="chat-body" class="chat-body" style="display: none;">
        <div id="chat-messages" class="chat-messages"></div>
        <div class="chat-input">
            <input type="text" id="chatInput" placeholder="Type a message...">
            <button onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>
</div>

<div class="modal" id="productDetailsModal">
    <div class="modal-box" style="max-width:800px;">
        <button class="modal-close" onclick="closeModal('productDetailsModal')">&times;</button>
        <div class="details-grid">
            <img id="detailImg" src="" alt="Product">
            <div class="details-info">
                <h2 id="detailName"></h2>
                <p id="detailDesc"></p>
                <p class="price" id="detailPrice"></p>
                <p id="detailStock" style="font-size: 0.9rem; margin-bottom: 15px; font-weight: 600;"></p>
                <textarea id="engravingText" placeholder="Personalization details..."></textarea>
                <input type="number" id="orderQty" value="1" min="1">
                <button class="btn-primary" onclick="placeOrder()">Place Order</button>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="orderSuccessModal">
    <div class="modal-box success-modal-box">
        <div class="success-icon-wrapper">
            <i class="fas fa-check"></i>
        </div>
        <h2 class="success-title">Order Placed!</h2>
        <p class="success-message">
            Thank you for your purchase. Your faith-inspired engraving is now being processed. You can track its status in your order history.
        </p>
        <div class="success-actions">
            <button class="btn-primary w-100" onclick="goToOrders()">
                <i class="fas fa-shopping-bag icon-left"></i> View My Orders
            </button>
            <button class="btn-outline w-100" onclick="closeModal('orderSuccessModal'); showSection('products');">
                Continue Shopping
            </button>
        </div>
    </div>
</div>

<div class="modal" id="cancelOrderModal">
    <div class="modal-box cancel-modal-box">
        <button class="modal-close" onclick="closeModal('cancelOrderModal')">&times;</button>
        <h3 class="cancel-modal-title">Cancel Order</h3>
        <p class="cancel-modal-text">Please tell us why you are cancelling this order. This action cannot be undone.</p>
        
        <div class="cancel-form-group">
            <label for="cancelReason" class="cancel-label">Reason for Cancellation *</label>
            <select id="cancelReason" class="cancel-select">
                <option value="" disabled selected>Select a reason...</option>
                <option value="Changed my mind">I changed my mind</option>
                <option value="Ordered by mistake">I ordered by mistake</option>
                <option value="Found a better price elsewhere">Found a better price elsewhere</option>
                <option value="Shipping time is too long">Shipping time is too long</option>
                <option value="Other">Other</option>
            </select>
        </div>

        <input type="hidden" id="cancelOrderIdToSubmit">

        <div class="cancel-actions">
            <button class="btn-outline" onclick="closeModal('cancelOrderModal')">Keep Order</button>
            <button class="btn-primary btn-danger" onclick="submitCancellation()" id="confirmCancelBtn">
                Confirm Cancel
            </button>
        </div>
    </div>
</div>

<div class="modal" id="passwordSuccessModal">
    <div class="modal-box success-modal-box">
        <div class="success-icon-wrapper">
            <i class="fas fa-lock"></i> </div>
        <h2 class="success-title">Password Updated!</h2>
        <p class="success-message">
            Your account password has been successfully changed. Please use your new password the next time you log in.
        </p>
        <div class="success-actions">
            <button class="btn-primary w-100" onclick="closeModal('passwordSuccessModal'); showSection('account');">
                Back to My Account
            </button>
        </div>
    </div>
</div>

<div class="modal" id="updateSuccessModal">
    <div class="modal-box success-modal-box">
        <div class="success-icon-wrapper" style="background: #d1e7dd; color: #0f5132;">
            <i class="fas fa-user-check"></i>
        </div>
        <h2 class="success-title">Update Complete!</h2>
        <p class="success-message">
            Your account details have been successfully updated. Your profile now reflects your latest information.
        </p>
        <div class="success-actions">
            <button class="btn-primary w-100" onclick="closeModal('updateSuccessModal'); showSection('account');">
                Back to My Account
            </button>
        </div>
    </div>
</div>

<script type="module" src="firebase-config.js"></script>
<script type="module" src="user.js?v=101"></script>
</body>
</html>